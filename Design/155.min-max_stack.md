- if stack only has pop node function, then that means each write function (push/pop) only applies to the latest node, the min node is an immutable state that is associated with each node.
    - min node for prev node is not changed when the curr node is popped.

- if stack has pop node and pop max function, then the max state for each node could get changed as a result of pop max function. 
    - by storing iterator for each node in val treemap, the later nodes for that value is always later in the vector. So for each pop max function, we remove from the end of the iterators.

```cpp
class MaxStack {
private:
    map<int, vector<list<int>::iterator>>val; //so the newer instances are at the back
    list<int>nodes;
public:
    /** initialize your data structure here. */
    MaxStack() {
        
    }
    
    void push(int x) { //O(LogN)
        nodes.push_front(x);
        val[x].push_back(nodes.begin());
    }
    
    int pop() { //O(LogN)
        int res = nodes.front();
        nodes.pop_front();
        val[res].pop_back();
        if (val[res].empty()) 
            val.erase(res);
        return res;
    }
    
    int top() {
        return nodes.front();
    }
    
    int peekMax() {
        return val.rbegin()->first;  //returns the value of the last item in value treemap
    }
    
    int popMax() { //O(logN)
        int res = val.rbegin()->first;
        auto it = val[res].back(); 
        nodes.erase(it);
        val[res].pop_back();
        if (val[res].empty()) 
            val.erase(res);
        return res;
    }
};
```
